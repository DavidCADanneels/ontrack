<ot-view>
    <div class="row">
        <div class="col-md-12">
            <ot-creation creation="build.creation"></ot-creation>
        </div>
    </div>
    <!-- Promotions -->
    <div class="row">
        <div class="col-md-4">
            <ot-section-title>Promotions</ot-section-title>
            <div class="ot-description" ng-if="build.promotionRuns.length == 0">
                No promotion yet.
            </div>
            <table class="table table-condensed table-hover">
                <tbody>
                <tr ng-repeat="promotionRun in build.promotionRuns">
                    <td>
                        <ot-entity-image entity="promotionRun.promotionLevel"></ot-entity-image>
                        {{promotionRun.promotionLevel.name}}
                    </td>
                    <td>
                        <ot-creation creation="promotionRun.creation"></ot-creation>
                    </td>
                    <td>
                        {{promotionRun.description}}
                    </td>
                    <td>
                        <span
                            ng-if="promotionRun.links._delete"
                            ng-click="deletePromotionRun(promotionRun)"
                            title="Delete this promotion."
                            class="ot-command ot-command-delete"></span>
                     </td>
                </tr>
                </tbody>
            </table>
        </div>
        <!-- Validations -->
        <div class="col-md-8">
            <ot-section-title>Validations</ot-section-title>
            <div class="ot-description" ng-if="build.validationRuns.length == 0">
                No validation yet.
            </div>
            <table class="table table-condensed table-hover">
                <tbody>
                <tr ng-repeat="validationRun in build.validationRuns">
                    <td>
                        <ot-entity-image entity="validationRun.validationStamp"
                                         link="#/validationStamp/{{validationRun.validationStamp.id}}">
                            {{validationRun.validationStamp.name}}
                        </ot-entity-image>
                    </td>
                    <td>
                        <a href="#/validationRun/{{validationRun.id}}">
                            #{{validationRun.runOrder}}
                        </a>
                    </td>
                    <td>
                        <a href="#/validationRun/{{validationRun.id}}">
                            <ot-validation-run-status status="validationRun.validationRunStatuses[0]"></ot-validation-run-status>
                        </a>
                    </td>
                    <td>
                        {{validationRun.validationRunStatuses[0].description}}
                    </td>
                    <td>
                        <ot-creation creation="validationRun.creation"></ot-creation>
                    </td>
                    <td>
                           <span ng-if="validationRun.runInfo.sourceType && validationRun.runInfo.sourceUri">
                               <a href="{{validationRun.runInfo.sourceUri}}">{{validationRun.runInfo.sourceType}}</a>
                           </span>
                    </td>
                    <td>
                           <span ng-if="validationRun.runInfo.triggerType && validationRun.runInfo.triggerData">
                               {{validationRun.runInfo.triggerType}}
                               ->
                               {{validationRun.runInfo.triggerData}}
                           </span>
                    </td>
                    <td>
                            <span ng-if="validationRun.runInfo.runTime">
                                <ot-duration duration="validationRun.runInfo.runTime"></ot-duration>
                            </span>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="row">
                <div class="col-md-4">
                    <ot-subsection-title>Run &amp; passed</ot-subsection-title>
                    <p class="ot-description">List of validations that have run and passed.</p>

                    <div class="well">
                        <table class="ot-validation-runs">
                            <tr ng-repeat="validationStampRunView in validationStampRunViewCollection.resources"
                                ng-if="validationStampRunView.run && validationStampRunView.passed">
                                <td>
                                    <ot-validation-stamp-run-view validation-stamp-run-view="validationStampRunView"></ot-validation-stamp-run-view>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="col-md-4">
                    <ot-subsection-title>Run &amp; failed</ot-subsection-title>
                    <p class="ot-description">List of validations that have run and failed.</p>

                    <div class="well">
                        <table class="ot-validation-runs">
                            <tr ng-repeat="validationStampRunView in validationStampRunViewCollection.resources"
                                ng-if="validationStampRunView.run && !validationStampRunView.passed">
                                <td>
                                    <ot-validation-stamp-run-view validation-stamp-run-view="validationStampRunView"></ot-validation-stamp-run-view>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="col-md-4">
                    <ot-subsection-title>Not run</ot-subsection-title>
                    <p class="ot-description">List of validations that have not run.</p>

                    <div class="well">
                        <table class="ot-validation-runs">
                            <tr ng-repeat="validationStampRunView in validationStampRunViewCollection.resources"
                                ng-if="!validationStampRunView.run">
                                <td>
                                    <ot-validation-stamp-run-view validation-stamp-run-view="validationStampRunView"></ot-validation-stamp-run-view>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- TODO Used by... -->
    <div class="row">
        <div class="col-md-6">
            <ot-section-title>Properties</ot-section-title>
            <div class="row">
                <div class="col-md-12">
                    <ot-entity-properties entity="{_properties: build.links._properties}"></ot-entity-properties>
                </div>
            </div>
            <ot-entity-events entity="{_events: build.links._events}"></ot-entity-events>
        </div>
        <div class="col-md-6">
            <ot-section-title>Extra information</ot-section-title>
            <div class="row">
                <div class="col-md-12">
                    <ot-entity-extra entity="{_extra: build.links._extra}"></ot-entity-extra>
                </div>
            </div>
        </div>
    </div>
</ot-view>