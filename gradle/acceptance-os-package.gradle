/**
 * Acceptance tests for the OS packages
 */

import net.nemerosa.ontrack.gradle.DockerExec
import net.nemerosa.ontrack.gradle.DockerStart
import net.nemerosa.ontrack.gradle.DockerStop

/**
 * Debian tests
 */

task debDockerStart(type: DockerStart) {
    image = 'ubuntu:vivid'
    tty = true
    command = '/bin/cat'
}

task debDockerInstall(type: DockerExec, dependsOn: debDockerStart) {
    startTask = 'debDockerStart'
    commands = ['echo', 'Test']
}

task debDockerStop(type: DockerStop) {
    startTask = 'debDockerStart'
}

task debAcceptanceTest(/*type: RemoteAcceptanceTest*/) {
//    acceptanceUrl = { "https://${project.properties.acceptanceHost}:${debDockerStart.port}" }
//    disableSsl = true
    dependsOn debDockerInstall
    finalizedBy debDockerStop
}

/**
 * TODO RPM tests
 */

task rpmAcceptanceTest

/**
 * OS packages tests
 */

task osPackageAcceptanceTest {
    dependsOn debAcceptanceTest
    dependsOn rpmAcceptanceTest
}